#!/bin/bash

echo "[TASK 1] Join node to Kubernetes Cluster"
cat >>~/.ssh/id_rsa<<EOF
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
EOF

echo "[TASK 2] Change private key permission"
chmod 400 ~/.ssh/id_rsa

echo "[TASK 3] Pull cluster connection token"
scp -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no root@192.168.56.2:/joincluster.sh /joincluster.sh

echo "[Task 4] Join the cluster"
bash /joincluster.sh